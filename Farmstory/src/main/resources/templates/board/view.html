<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>글보기</title>
    <link rel="stylesheet" th:href="@{/css/style.css}"/>
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
        <script>
          $(document).ready(function(){
             
             // 댓글 삭제
             $('.btnCommentDel').click(function(){
                var result = confirm('정말 삭제 하시겠습니까?');
                return result;
             });
             
             
             var content = '';
             
             // 댓글 수정
             $('.btnCommentModify').click(function(){
                
                var tag = $(this);
                var mode = $(this).text();                          
                var textarea = $(this).parent().prev();
                
                if(mode == '수정'){
                   // 수정모드
                   content = textarea.val(); 
                   
                   $(this).prev().css('display', 'none');
                   $(this).next().css('display', 'inline');
                   $(this).text('수정완료');
                   textarea.attr('readonly', false).focus();
                    textarea.css({
                       'background': 'white',
                       'outline': '1px solid gray'
                     
                    });
                    
                }else{

                   // 수정모드 해제 
                  tag.text('수정');
                  tag.prev().css('display', 'inline');
                  tag.next().css('display', 'none');                                                   
                   textarea.attr('readonly', true);
                   textarea.css({
                      'background': 'transparent',
                      'outline': 'none'
                   });
                   
                   // 수정완료 모드
                   // data-seq -> data의 속성을 seq로 적어준것이다.
                   var seq     = textarea.attr("data-seq"); 
                   var content = textarea.val(); 
                   
                     var jsonData = {
                         'seq': seq,
                         'content': content
                         // content(이 content는 var의 변수명으로서 textarea.val()의 내용을 담아주는 역할 )를 'content'<ArticleVo에 설정되어 있는>로 저장하는 것이다 ,,,
                         // 이제 이 content를 담은 'content'가 jsonData로 변형되어 출력되기 위하여 BoardController에서 completeComment로 설정해준 
                         // controller로 간다
					};
                      
                   // 다시 controller에서 return준 json값을 여기서 처리해준다 <view페이지에서 출력하는 것이아니고 > 밑의 ajax 부분을 통하여 출력하는 것이다
                   $.ajax({
                      url: '/board/completeComment',
                      type: 'post',
                      data: jsonData,   // 서버로 전송하는 데이터(JSON) 지정
                      dataType: 'json', // 서버로 부터 전달되는 데이터 종류
                      success: function(data){
                         alert('수정하시겠습니까?')
                      }   
                   });
                }
               
             });
             
             // 댓글 수정 취소
             $('.btnCommentCancel').click(function(e){
                e.preventDefault();
                $(this).prev().text('수정');
                $(this).prev().prev().css('display', 'inline');
                $(this).css('display', 'none');
                
                var textarea = $(this).parent().prev();
                
                textarea.val(content);
                textarea.attr('readonly', true);
                textarea.css({
                   'background': 'transparent',
                   'outline': 'none'
                });   
             });
          });
    </script>
</head>
<body>
    <div id="wrapper">
      <th:block th:include="@{/_header.html}"></th:block>
      <th:block th:include="@{/board/_aside__${group}__.html}"></th:block>
        <section id="board" class="view">
            <h3>글보기</h3>
            <table>
                <tr>
                    <td>제목</td>
                    <td><input type="text" name="title" th:value="${articleVo.title}" readonly/></td>
                </tr>
                <tr th:if="${articleVo.file == 1}">
                    <td>첨부파일</td>
                    <td>
                          <a th:href="@{/fileDownload(fseq=${articleVo.fileVo.fseq})}">[[${articleVo.fileVo.oriName}]]</a><br/>
                        <span>[[${articleVo.fileVo.download}]]회 다운로드</span>
                    </td>
                </tr>
                <tr>
                    <td>내용</td>
                    <td>
                        <textarea name="content" readonly>[[${articleVo.content}]]</textarea>
                    </td>
                </tr>
            </table>
            <div>
                <a th:href="@{/board/delete(group=${group},cate=${cate},seq=${articleVo.seq})}" class="btnDelete">삭제</a>
                <a th:href="@{/board/modify(group=${group},cate=${cate},seq=${articleVo.seq})}" class="btnModify">수정</a>
                <a th:href="@{/board/list(group=${group},cate=${cate})}" class="btnList">목록</a>
            </div>  
            
            <!-- 댓글리스트 -->
            <section class="commentList">
                <h3>댓글목록</h3>
                <article th:each="comment:${comments}" class="comment">
                    <span>
                        <span>[[${comment.nick}]]</span>
                        <span>[[${comment.rdate.substring(2,10)}]]</span>
                    </span>                    
                    <textarea name="comment" th:data-seq="${comment.seq}"  readonly>[[${comment.content}]]</textarea>
                    <div>
                        <a th:href="@{/board/deleteComment(group=${group},cate=${cate},seq=${comment.seq},parent=${comment.parent})}" class="btnCommentDel">삭제</a>
                        <a th:href="@{#}" class="btnCommentModify">수정</a>
                        <a th:href="@{/board/view(group=${group},cate=${cate},seq=${comment.seq})}" class="btnCommentCancel" style="display:none">취소</a>
                    </div>
                </article>
                <p th:if="${comments.size == 0}" class="empty">
                    등록된 댓글이 없습니다.
                </p>
            </section>

            <!-- 댓글입력폼 -->
            <section class="commentForm">
                <h3>댓글쓰기</h3>
                <form th:action="@{/board/insertComment(group=${group},cate=${cate},seq=${articleVo.seq})}" method="post">
                <input type="hidden" name="parent" th:value="${articleVo.seq}">
                <input type="hidden" name="uid"    th:value="${session.sessMember.uid}">
     
                    <textarea name="content"></textarea>
                    <div>
                        <a th:href="@{/board/view(group=${group},cate=${cate},seq=${articleVo.seq})}" class="btnCancel">취소</a>
                        <input type="submit" class="btnWrite" value="작성완료"/>
                    </div>
                </form>
            </section>

        </section>
         <th:block th:include="/_footer.html"></th:block>
    </div>    
</body>
</html>